node('master') {
  def dockerTool = tool name: 'docker', type: 'org.jenkinsci.plugins.docker.commons.tools.DockerTool'
  def nodeTool = tool name: 'node', type: 'nodejs'
  
  env.PATH="${env.PATH}:${nodeTool}/bin:${dockerTool}"
  
  stage('Cloning repository.') {
    checkout scm
  }

  stage('Installing dependencies.') {
    sh 'yarn'
  }

  stage('Running unit tests') {
    nodejs(nodeJSInstallationName: 'node') {
      sh "yarn test"
     }
  }

  stage('Running unit tests') {
    sh "docker run --name hello hello-world"
  }

  stage('Running unit tests') {
    sh "docker stop hello"
  }

}
