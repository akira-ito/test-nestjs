node('master') {
  def dockerTool = tool name: 'docker', type: 'org.jenkinsci.plugins.docker.commons.tools.DockerTool'
  tools {
    nodejs 'node'
  }
  
  withEnv(["DOCKER=${dockerTool}/bin"]) {
      stage('Cloning repository.') {
        checkout scm
      }
      
      stage('Installing dependencies.') {
        sh "yarn"
      }
      
      stage('Running unit tests') {
        sh "yarn test"
      }
      
      stage('Running unit tests') {
        sh "docker ps"
      }
  }
}

def dockerCmd(args) {
    sh "sudo ${DOCKER}/docker ${args}"
}
